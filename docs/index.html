<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clean Water Quality Data for NPDES Reasonable Potential Analyses • reasonabletools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Clean Water Quality Data for NPDES Reasonable Potential Analyses">
<meta property="og:description" content='Functions for cleaning and summarising water quality data for use in National Pollutant Discharge Elimination Service (NPDES) permit reasonable potential analyses and water quality-based effluent limitation calculations. Procedures are based on those contained in the "Technical Support Document for Water Quality-based Toxics Control", United States Environmental Protection Agency (1991). '>
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">reasonabletools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mattreusswig/reasonabletools/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="reasonabletools" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#reasonabletools" class="anchor"></a>reasonabletools</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>This package provides the user with convenience functions for cleaning and summarizing data for use in Reasonable Potential Analyses (RPAs) and Water Quality-based Effluent Limitation (WQBEL) development. Examples of tasks one can do with reasonabletools include constructing composite parameter measurement (e.g., total PCBs) from congener water samples, finding maximum observed concentrations from partially censored datasets, and projecting maximum effluent concentrations (MECs). Methods for projecting MECs and computing effluent limitations are based on EPA’s Technical Support Document for Water Quality-based Toxics Control (TSD).</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the current stable version of the package from CRAN using the following:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"reasonabletools"</span><span class="op">)</span></code></pre></div>
<p>You can install the current development version of reasonabletools from <a href="https://github.com/mattreusswig/reasonabletools">github</a> using devtools.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># If devetools is not installed, install it.</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span>

<span class="co"># Install reasonabletools from the github repository.</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"mattreusswig/reasonabletools"</span><span class="op">)</span></code></pre></div>
</div>
<div id="assumptions-for-cvs-and-distributions" class="section level2">
<h2 class="hasAnchor">
<a href="#assumptions-for-cvs-and-distributions" class="anchor"></a>Assumptions for CVs and Distributions</h2>
<div id="minimum-information-content-for-cv" class="section level3">
<h3 class="hasAnchor">
<a href="#minimum-information-content-for-cv" class="anchor"></a>Minimum Information Content for CV</h3>
<p>Consistent with the TSD, reasonabletools requires a minimum level of information content in the dataset in order to estimate the Coefficient of Variation (CV) for a pollutant. There must be at least 10 observations and fewer than 80 percent of the dataset must be non-detect to calculate a CV value. If either condition is not met, a CV value of 0.6 is assumed and output.</p>
</div>
<div id="non-detects-substitution" class="section level3">
<h3 class="hasAnchor">
<a href="#non-detects-substitution" class="anchor"></a>Non-Detects Substitution</h3>
<p>Consistent with the TSD, reasonabletools uses substitution methods when calculating mean and standard deviation values when non-detects are present. When non-detects are present, result values corresponding to non-detect qual values are multiplied by 0.5 prior to computing the mean and standard deviation.</p>
</div>
<div id="distributional-assumptions" class="section level3">
<h3 class="hasAnchor">
<a href="#distributional-assumptions" class="anchor"></a>Distributional Assumptions</h3>
<p>Consistent with the TSD, reasonabletools assumes a lognormal distribution is applicable to the data when performing effluent limitation computations.</p>
</div>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>Functions in reasonabletools accept vectors as arguments–typically, a vector of numeric data representing concentration point measurements or detection limits, and a vector of character data indicating the detected/non-detect/detected-but-not-quantified status of each numeric value.</p>
<p>Combining the input vectors in a dataframe or a tibble is not necessary, but can be useful when developing summaries for multiple pollutants at once (see discussion below).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mattreusswig/reasonabletools">reasonabletools</a></span><span class="op">)</span>

<span class="co">## Create an example dataset</span>
<span class="va">zinc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>qual   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">""</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"&lt;"</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,
                   result <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,
                   stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">zinc</span>
<span class="co">#&gt;    qual result</span>
<span class="co">#&gt; 1            1</span>
<span class="co">#&gt; 2            2</span>
<span class="co">#&gt; 3            3</span>
<span class="co">#&gt; 4            4</span>
<span class="co">#&gt; 5            5</span>
<span class="co">#&gt; 6            6</span>
<span class="co">#&gt; 7            7</span>
<span class="co">#&gt; 8            8</span>
<span class="co">#&gt; 9            9</span>
<span class="co">#&gt; 10          10</span>
<span class="co">#&gt; 11    &lt;     11</span>
<span class="co">#&gt; 12    &lt;     12</span>
<span class="co">#&gt; 13    &lt;     13</span>
<span class="co">#&gt; 14    &lt;     14</span>
<span class="co">#&gt; 15    &lt;     15</span>
<span class="co">#&gt; 16    &lt;     16</span>
<span class="co">#&gt; 17    &lt;     17</span>
<span class="co">#&gt; 18    &lt;     18</span>
<span class="co">#&gt; 19    &lt;     19</span>
<span class="co">#&gt; 20    &lt;     20</span>

<span class="co">## Find observed MEC</span>
<span class="fu"><a href="reference/find_mec.html">find_mec</a></span><span class="op">(</span>qual <span class="op">=</span> <span class="va">zinc</span><span class="op">$</span><span class="va">qual</span>, result <span class="op">=</span> <span class="va">zinc</span><span class="op">$</span><span class="va">result</span><span class="op">)</span>
<span class="co">#&gt;   qual result</span>
<span class="co">#&gt; 1          10</span></code></pre></div>
<div id="non-detects-detected-values-and-dnqs" class="section level3">
<h3 class="hasAnchor">
<a href="#non-detects-detected-values-and-dnqs" class="anchor"></a>Non-Detects, Detected Values, and DNQs</h3>
<p>Functions in reasonabletools can distinguish between detected and non-detect values. Non-detect values are indicated in the qualifier vector with pre-specified character string. By default, this is a “&lt;”, “nd”, or “ND” character string. Any string in the non-detect qualifier vector which does not match these indicators is treated as a detected value. However, the non-detect flags can be changed using the “nd” argument (e.g., you could change it to “My ND Indicator”–see example below). In function output, “&lt;” is always used to indicate a censored value and an empty string "" is used to indicate a detected value.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Create an example dataset with new custom non-detect indicator</span>
<span class="va">zinc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>qual   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"My ND Indicator"</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span>,
                   result <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,
                   stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">zinc</span>
<span class="co">#&gt;               qual result</span>
<span class="co">#&gt; 1  My ND Indicator      1</span>
<span class="co">#&gt; 2  My ND Indicator      2</span>
<span class="co">#&gt; 3  My ND Indicator      3</span>
<span class="co">#&gt; 4  My ND Indicator      4</span>
<span class="co">#&gt; 5  My ND Indicator      5</span>
<span class="co">#&gt; 6  My ND Indicator      6</span>
<span class="co">#&gt; 7  My ND Indicator      7</span>
<span class="co">#&gt; 8  My ND Indicator      8</span>
<span class="co">#&gt; 9  My ND Indicator      9</span>
<span class="co">#&gt; 10 My ND Indicator     10</span>
<span class="co">#&gt; 11 My ND Indicator     11</span>
<span class="co">#&gt; 12 My ND Indicator     12</span>
<span class="co">#&gt; 13 My ND Indicator     13</span>
<span class="co">#&gt; 14 My ND Indicator     14</span>
<span class="co">#&gt; 15 My ND Indicator     15</span>
<span class="co">#&gt; 16 My ND Indicator     16</span>
<span class="co">#&gt; 17 My ND Indicator     17</span>
<span class="co">#&gt; 18 My ND Indicator     18</span>
<span class="co">#&gt; 19 My ND Indicator     19</span>
<span class="co">#&gt; 20 My ND Indicator     20</span>

<span class="co">## Find observed MEC</span>
<span class="fu"><a href="reference/find_mec.html">find_mec</a></span><span class="op">(</span>qual <span class="op">=</span> <span class="va">zinc</span><span class="op">$</span><span class="va">qual</span>, result <span class="op">=</span> <span class="va">zinc</span><span class="op">$</span><span class="va">result</span>, 
         nd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"My ND Indicator"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   qual result</span>
<span class="co">#&gt; 1    &lt;      1</span></code></pre></div>
<p>When cleaning data for summary, recall that R is a case-sensitive language and capitalization matters in non-detect flags. The default censored flags in reasonabletools are “&lt;”, “nd”, and “ND”. This means an observation in your data marked “nd” will be treated as a non-detect, but an observation marked “nD” (notice the change in capitalization on the second letter) will be treated as a detected value.</p>
<p>All elements in the results vector should have a numeric value–do not include NA values. For non-detect values, the method detection limit should be entered in the results column. NA values in the results column are ignored and will result in incorrect results.</p>
<p>Functions in reasonabletools do not have specialized behavior for an observation which is detected-but-not-quantified (DNQ or j-flag). The user must decide when preprocessing the data whether these values should be treated as non-detect values or as detected values. The observation should be marked as non-detect or detected in the qualifier vector, and the reporting limit or estimated concentration placed in result vector.</p>
</div>
</div>
<div id="working-with-multiple-pollutants" class="section level2">
<h2 class="hasAnchor">
<a href="#working-with-multiple-pollutants" class="anchor"></a>Working with Multiple Pollutants</h2>
<p>Real-life datasets used in NPDES permit development will typically include many pollutants of concern which need to be summarized. This is a split-apply-combine task which is cumbersome to address in Excel and other spreadsheet-based programs for anything but simple summary functions (e.g., computing averages or maximums without conditionality).</p>
<p>In base R (or using dplyr/tidyverse methods) this task becomes straightforward. Here are some strategies from base R and dplyr for summarizing effluent data with reasonabletools.</p>
<p>We will use the following toy dataset in these examples:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">10010</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>pollutant <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"zinc"</span>, <span class="st">"arsenic"</span>, <span class="st">"copper"</span>,
                                          <span class="st">"lead"</span>, <span class="st">"nickel"</span>, <span class="st">"pcbs"</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,
                   qualifier <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;"</span>, <span class="st">""</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">30</span>, 
                                      replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span>,
                   result <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span><span class="op">)</span>, <span class="fl">30</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
                   sampling.date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2012-03-10"</span><span class="op">)</span>, 
                                                to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2012-03-10"</span><span class="op">)</span> <span class="op">+</span> <span class="fl">365</span> <span class="op">*</span> <span class="fl">4</span>,
                                                by <span class="op">=</span> <span class="fl">365</span><span class="op">)</span>, <span class="fl">6</span><span class="op">)</span>,
                   stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">data</span>
<span class="co">#&gt;    pollutant qualifier result sampling.date</span>
<span class="co">#&gt; 1    arsenic         &lt;    0.1    2012-03-10</span>
<span class="co">#&gt; 2    arsenic              0.3    2013-03-10</span>
<span class="co">#&gt; 3    arsenic         &lt;    0.4    2014-03-10</span>
<span class="co">#&gt; 4    arsenic         &lt;    0.1    2015-03-10</span>
<span class="co">#&gt; 5    arsenic         &lt;    0.3    2016-03-09</span>
<span class="co">#&gt; 6     copper         &lt;    0.5    2012-03-10</span>
<span class="co">#&gt; 7     copper         &lt;    0.4    2013-03-10</span>
<span class="co">#&gt; 8     copper         &lt;    0.5    2014-03-10</span>
<span class="co">#&gt; 9     copper         &lt;    0.5    2015-03-10</span>
<span class="co">#&gt; 10    copper         &lt;    0.2    2016-03-09</span>
<span class="co">#&gt; 11      lead         &lt;    0.1    2012-03-10</span>
<span class="co">#&gt; 12      lead         &lt;    0.1    2013-03-10</span>
<span class="co">#&gt; 13      lead         &lt;    0.2    2014-03-10</span>
<span class="co">#&gt; 14      lead         &lt;    0.4    2015-03-10</span>
<span class="co">#&gt; 15      lead         &lt;    0.4    2016-03-09</span>
<span class="co">#&gt; 16    nickel              0.5    2012-03-10</span>
<span class="co">#&gt; 17    nickel              0.2    2013-03-10</span>
<span class="co">#&gt; 18    nickel         &lt;    0.4    2014-03-10</span>
<span class="co">#&gt; 19    nickel         &lt;    0.1    2015-03-10</span>
<span class="co">#&gt; 20    nickel         &lt;    0.3    2016-03-09</span>
<span class="co">#&gt; 21      pcbs         &lt;    0.2    2012-03-10</span>
<span class="co">#&gt; 22      pcbs              0.4    2013-03-10</span>
<span class="co">#&gt; 23      pcbs         &lt;    0.5    2014-03-10</span>
<span class="co">#&gt; 24      pcbs         &lt;    0.2    2015-03-10</span>
<span class="co">#&gt; 25      pcbs         &lt;    0.4    2016-03-09</span>
<span class="co">#&gt; 26      zinc              0.4    2012-03-10</span>
<span class="co">#&gt; 27      zinc         &lt;    0.3    2013-03-10</span>
<span class="co">#&gt; 28      zinc         &lt;    0.5    2014-03-10</span>
<span class="co">#&gt; 29      zinc              0.2    2015-03-10</span>
<span class="co">#&gt; 30      zinc         &lt;    0.3    2016-03-09</span></code></pre></div>
<div id="base-r" class="section level3">
<h3 class="hasAnchor">
<a href="#base-r" class="anchor"></a>Base R</h3>
<p>Use the split family of functions to create a list of dataframes grouped by pollutant name, use lapply to apply the function to each element of the list, and do.call + rbind to recombine the output.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">data_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split.data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data</span>, f <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">pollutant</span><span class="op">)</span>

<span class="co">## Note we need to use an anonymous function in lapply for functions with</span>
<span class="co">## multiple non-default input arguments, like find_mec.</span>
<span class="va">data_apply</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data_split</span>, 
                     FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="reference/find_mec.html">find_mec</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">qualifier</span>, <span class="va">x</span><span class="op">$</span><span class="va">result</span><span class="op">)</span><span class="op">)</span>

<span class="va">combined_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">data_apply</span><span class="op">)</span>

<span class="va">combined_summary</span>
<span class="co">#&gt;         qual result</span>
<span class="co">#&gt; arsenic         0.3</span>
<span class="co">#&gt; copper     &lt;    0.2</span>
<span class="co">#&gt; lead       &lt;    0.1</span>
<span class="co">#&gt; nickel          0.5</span>
<span class="co">#&gt; pcbs            0.4</span>
<span class="co">#&gt; zinc            0.4</span></code></pre></div>
<p>Or, we can combine the apply and combine steps into a single line by nesting the functions. Unfortunately, we can’t do this in fewer than two steps.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_split</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split.data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data</span>, f <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">pollutant</span><span class="op">)</span>

<span class="va">combined_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span>
       <span class="va">rbind</span>, 
       <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data_split</span>, 
              FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="reference/find_mec.html">find_mec</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">qualifier</span>, <span class="va">x</span><span class="op">$</span><span class="va">result</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>

<span class="va">combined_summary</span>
<span class="co">#&gt;         qual result</span>
<span class="co">#&gt; arsenic         0.3</span>
<span class="co">#&gt; copper     &lt;    0.2</span>
<span class="co">#&gt; lead       &lt;    0.1</span>
<span class="co">#&gt; nickel          0.5</span>
<span class="co">#&gt; pcbs            0.4</span>
<span class="co">#&gt; zinc            0.4</span></code></pre></div>
</div>
<div id="dplyr-v10-or-later" class="section level3">
<h3 class="hasAnchor">
<a href="#dplyr-v10-or-later" class="anchor"></a>dplyr (v1.0 or later)</h3>
<p>Using dplyr is often a more intuitive way to implement split-apply-combine for many people. Using dplyr, we will use dplyr::group_by and wrap the reasonabletools summary function in dplyr::summarise and it will automatically output all columns grouped by pollutant. (Note that old versions of dplyr::summarise (pre-1.0) are not set up to output two columns from a single summary function–see the next section for pre-1.0 dplyr strategies.)</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="va">data</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">pollutant</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="reference/find_mec.html">find_mec</a></span><span class="op">(</span><span class="va">qualifier</span>, <span class="va">result</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   pollutant qual  result</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 arsenic   ""       0.3</span>
<span class="co">#&gt; 2 copper    "&lt;"      0.2</span>
<span class="co">#&gt; 3 lead      "&lt;"      0.1</span>
<span class="co">#&gt; 4 nickel    ""       0.5</span>
<span class="co">#&gt; 5 pcbs      ""       0.4</span>
<span class="co">#&gt; 6 zinc      ""       0.4</span></code></pre></div>
</div>
<div id="dplyr-pre-v10" class="section level3">
<h3 class="hasAnchor">
<a href="#dplyr-pre-v10" class="anchor"></a>dplyr (Pre-v1.0)</h3>
<p>Older versions of dplyr were not set up to handle multiple column output in the summarise functions. There were two main workarounds for this–one built into reasonabletools and one using dplyr itself.</p>
<p>A number of data summarising functions in reasonabletools that output two column values, like find_mec or project_mec, include an option for automatically concatenating the two output vectors into a single character vector. The “simple_output” argument will produce a single character vector when set to TRUE, and will produce two vectors when left at its default FALSE value.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="co">## simple_output = TRUE turns output into single character vector.</span>
<span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">pollutant</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>MEC <span class="op">=</span> <span class="fu"><a href="reference/find_mec.html">find_mec</a></span><span class="op">(</span><span class="va">qualifier</span>, <span class="va">result</span>, simple_output <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   pollutant MEC  </span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;</span>
<span class="co">#&gt; 1 arsenic   0.3  </span>
<span class="co">#&gt; 2 copper    &lt;0.2 </span>
<span class="co">#&gt; 3 lead      &lt;0.1 </span>
<span class="co">#&gt; 4 nickel    0.5  </span>
<span class="co">#&gt; 5 pcbs      0.4  </span>
<span class="co">#&gt; 6 zinc      0.4</span></code></pre></div>
<p>Note this setting is also useful when constructing summary tables for inclusion in permit documents where one wants to present the qualifier and value in the same table cell.</p>
<p>If one wants both output vectors retained in the output, use the dplyr::do function as a wrapper around the desired reasonabletools function. Use a dot prior to the $ operator and column name (e.g., .$qualifier) to indicate to dplyr::do it should look for the inputs in the piped dataframe.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">pollutant</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/do.html">do</a></span><span class="op">(</span><span class="fu"><a href="reference/find_mec.html">find_mec</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">qualifier</span>, <span class="va">.</span><span class="op">$</span><span class="va">result</span><span class="op">)</span><span class="op">)</span> 
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt; # Groups:   pollutant [6]</span>
<span class="co">#&gt;   pollutant qual  result</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 arsenic   ""       0.3</span>
<span class="co">#&gt; 2 copper    "&lt;"      0.2</span>
<span class="co">#&gt; 3 lead      "&lt;"      0.1</span>
<span class="co">#&gt; 4 nickel    ""       0.5</span>
<span class="co">#&gt; 5 pcbs      ""       0.4</span>
<span class="co">#&gt; 6 zinc      ""       0.4</span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=reasonabletools">https://​cloud.r-project.org/​package=reasonabletools</a>
</li>
<li>Browse source code at <br><a href="https://github.com/mattreusswig/reasonabletools/">https://​github.com/​mattreusswig/​reasonabletools/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/mattreusswig/reasonabletools/issues">https://​github.com/​mattreusswig/​reasonabletools/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Matthew Reusswig <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Matthew Reusswig.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
